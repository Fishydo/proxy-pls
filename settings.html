<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Settings</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600&display=swap');

    :root {
      --bg: #0f1114;
      --surface: #1b1e24;
      --surface-hover: #232831;
      --border: rgba(255, 255, 255, 0.08);
      --text: #e8eaed;
      --text-muted: #9aa0a6;
      --accent: #8ab4f8;
      --accent-strong: #a7c7ff;
    }

    [data-theme="light"] {
      --bg: #f1f3f4;
      --surface: #ffffff;
      --surface-hover: #f5f7f8;
      --border: rgba(60, 64, 67, 0.2);
      --text: #202124;
      --text-muted: #5f6368;
      --accent: #1a73e8;
      --accent-strong: #4285f4;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Roboto', system-ui, -apple-system, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    .settings-shell {
      display: grid;
      grid-template-columns: 240px 1fr;
      min-height: 100vh;
    }

    .sidebar {
      padding: 24px 18px;
      border-right: 1px solid var(--border);
      background: var(--surface);
    }

    .sidebar h1 {
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 20px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 10px;
      color: var(--text);
      text-decoration: none;
      font-size: 14px;
    }

    .nav-item.active,
    .nav-item:hover {
      background: var(--surface-hover);
    }

    .content {
      padding: 32px 40px;
    }

    .section {
      margin-bottom: 32px;
    }

    .section h2 {
      font-size: 18px;
      margin: 0 0 12px;
      font-weight: 600;
    }

    .section p {
      margin: 0 0 16px;
      color: var(--text-muted);
      font-size: 13px;
    }

    .card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px;
    }

    .theme-toggle {
      display: flex;
      gap: 10px;
    }

    .theme-btn {
      flex: 1;
      height: 36px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      cursor: pointer;
    }

    .theme-btn.active,
    .theme-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .server-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .server-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: transparent;
    }

    .server-item.active {
      border-color: var(--accent);
      background: rgba(138, 180, 248, 0.08);
    }

    .server-name {
      font-size: 14px;
      font-weight: 500;
    }

    .server-url {
      font-size: 12px;
      color: var(--text-muted);
    }

    .server-actions {
      display: flex;
      gap: 8px;
    }

    .button {
      background: var(--accent);
      border: none;
      color: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
    }

    .button.secondary {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
    }

    .input-row {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }

    .input-row input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
    }
  </style>
</head>

<body>
  <div class="settings-shell">
    <aside class="sidebar">
      <h1>Settings</h1>
      <a class="nav-item active" href="#appearance"><i class="fa-solid fa-palette"></i> Appearance</a>
      <a class="nav-item" href="#proxy"><i class="fa-solid fa-server"></i> Proxy</a>
    </aside>
    <main class="content">
      <section class="section" id="appearance">
        <h2>Appearance</h2>
        <p>Choose a theme that matches your browsing environment.</p>
        <div class="card theme-toggle">
          <button class="theme-btn" data-theme="dark">Dark</button>
          <button class="theme-btn" data-theme="light">Light</button>
        </div>
      </section>
      <section class="section" id="proxy">
        <h2>Proxy Servers</h2>
        <p>Select the Wisp server to use for browsing.</p>
        <div class="card">
          <div class="server-list" id="server-list"></div>
          <div class="input-row">
            <input type="text" id="custom-wisp-input" placeholder="wss://your-wisp-server.com/wisp/">
            <button class="button" id="save-custom-wisp">Add</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const WISP_SERVERS = [
      { name: "DaydreamX's Wisp", url: "wss://dash.goip.de/wisp/" },
      { name: "Space's Wisp", url: "wss://register.goip.it/wisp/" },
      { name: "Rhw's Wisp", url: "wss://wisp.rhw.one/wisp/" }
    ];
    const WISP_PROTOCOLS = new Set(["ws:", "wss:"]);

    const themeButtons = document.querySelectorAll('.theme-btn');
    const serverList = document.getElementById('server-list');
    const customInput = document.getElementById('custom-wisp-input');
    const addButton = document.getElementById('save-custom-wisp');

    function getStoredWisps() {
      try {
        return JSON.parse(localStorage.getItem('customWisps') || '[]');
      } catch {
        return [];
      }
    }

    function normalizeWispUrl(value) {
      const trimmed = value.trim();
      if (!trimmed) return '';
      try {
        const url = new URL(trimmed);
        if (!WISP_PROTOCOLS.has(url.protocol)) return '';
        return url.href;
      } catch {
        return '';
      }
    }

    function setTheme(theme) {
      const nextTheme = theme === 'light' ? 'light' : 'dark';
      document.documentElement.dataset.theme = nextTheme;
      localStorage.setItem('theme', nextTheme);
      themeButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.theme === nextTheme));
      window.parent?.postMessage({ type: 'setTheme', theme: nextTheme }, '*');
    }

    function renderServers() {
      const current = localStorage.getItem('proxServer') || WISP_SERVERS[0].url;
      const all = [...WISP_SERVERS, ...getStoredWisps()];
      serverList.innerHTML = '';

      all.forEach((server, index) => {
        const item = document.createElement('div');
        item.className = `server-item ${server.url === current ? 'active' : ''}`;

        const info = document.createElement('div');
        info.innerHTML = `<div class="server-name">${server.name}</div><div class="server-url">${server.url}</div>`;

        const actions = document.createElement('div');
        actions.className = 'server-actions';

        const useButton = document.createElement('button');
        useButton.className = 'button secondary';
        useButton.textContent = 'Use';
        useButton.onclick = () => {
          localStorage.setItem('proxServer', server.url);
          window.parent?.postMessage({ type: 'setWisp', url: server.url }, '*');
          renderServers();
        };

        actions.appendChild(useButton);

        if (index >= WISP_SERVERS.length) {
          const deleteButton = document.createElement('button');
          deleteButton.className = 'button secondary';
          deleteButton.textContent = 'Remove';
          deleteButton.onclick = () => {
            const updated = getStoredWisps().filter(w => w.url !== server.url);
            localStorage.setItem('customWisps', JSON.stringify(updated));
            renderServers();
          };
          actions.appendChild(deleteButton);
        }

        item.appendChild(info);
        item.appendChild(actions);
        serverList.appendChild(item);
      });
    }

    addButton.onclick = () => {
      const normalized = normalizeWispUrl(customInput.value);
      if (!normalized) return;
      const custom = getStoredWisps();
      if (custom.some(w => w.url === normalized) || WISP_SERVERS.some(w => w.url === normalized)) return;
      custom.push({ name: `Custom ${custom.length + 1}`, url: normalized });
      localStorage.setItem('customWisps', JSON.stringify(custom));
      customInput.value = '';
      renderServers();
    };

    themeButtons.forEach(btn => btn.onclick = () => setTheme(btn.dataset.theme || 'dark'));

    const storedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.dataset.theme = storedTheme;
    themeButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.theme === storedTheme));
    renderServers();
  </script>
</body>

</html>
